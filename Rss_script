-- ⚽ Hitbox Control (Centered & Draggable)

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local lp = Players.LocalPlayer

-- ========= SETTINGS =========
local Settings = {
    Enabled = false,
    Power = 85,
    Cooldown = 0.2,
    HitboxSize = 12,
    MaxHitboxSize = 35
}

local lastKick = 0

-- ========= BALL FINDER =========
local function getBall()
    for _, obj in ipairs(workspace:GetChildren()) do
        if obj:IsA("BasePart") and (obj.Name:lower():find("ball")) then
            return obj
        end
    end
    return nil
end

-- ========= HITBOX SPHERE =========
if workspace:FindFirstChild("HitboxSphere_System") then
    workspace.HitboxSphere_System:Destroy()
end

local sphere = Instance.new("Part")
sphere.Name = "HitboxSphere_System"
sphere.Shape = Enum.PartType.Ball
sphere.Anchored = true
sphere.CanCollide = false
sphere.CastShadow = false
sphere.Material = Enum.Material.ForceField
sphere.Color = Color3.fromRGB(0, 255, 120)
sphere.Transparency = 1
sphere.Parent = workspace

local function updateSphere()
    sphere.Size = Vector3.new(Settings.HitboxSize, Settings.HitboxSize, Settings.HitboxSize)
    sphere.Transparency = Settings.Enabled and 0.5 or 1
end

-- ========= HIT LOGIC =========
RunService.Heartbeat:Connect(function()
    if not Settings.Enabled then return end
    local char = lp.Character
    local root = char and char:FindFirstChild("HumanoidRootPart")
    if not root then return end

    sphere.CFrame = root.CFrame * CFrame.new(0, 0, -2)

    local ball = getBall()
    if not ball then return end
    if tick() - lastKick < Settings.Cooldown then return end

    local dist = (ball.Position - sphere.Position).Magnitude
    if dist <= (Settings.HitboxSize / 2) then
        lastKick = tick()
        local dir = (ball.Position - root.Position).Unit
        ball.AssemblyLinearVelocity = (dir * Settings.Power) + Vector3.new(0, Settings.Power / 4, 0)
    end
end)

-- ========= UI SETUP =========
local gui = Instance.new("ScreenGui")
gui.Name = "SimpleHitboxUI"
gui.ResetOnSpawn = false
local success, err = pcall(function() gui.Parent = game:GetService("CoreGui") end)
if not success then gui.Parent = lp:WaitForChild("PlayerGui") end

-- Кнопка открытия
local toggleBtn = Instance.new("TextButton", gui)
toggleBtn.Size = UDim2.fromOffset(55, 55)
toggleBtn.Position = UDim2.fromOffset(20, 150)
toggleBtn.BackgroundColor3 = Color3.fromRGB(40, 40, 50)
toggleBtn.Text = "⚽"
toggleBtn.TextSize = 25
toggleBtn.TextColor3 = Color3.new(1, 1, 1)
local btnCorner = Instance.new("UICorner", toggleBtn)
btnCorner.CornerRadius = UDim.new(1, 0)

-- МЕНЮ (Теперь по центру)
local menu = Instance.new("Frame", gui)
menu.Size = UDim2.fromOffset(200, 180)
menu.Position = UDim2.new(0.5, 0, 0.5, 0) -- Центр экрана
menu.AnchorPoint = Vector2.new(0.5, 0.5)   -- Точка привязки в центре
menu.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
menu.Visible = false
menu.Active = true -- Нужно для перетаскивания

local menuCorner = Instance.new("UICorner", menu)
menuCorner.CornerRadius = UDim.new(0, 10)

-- Логика перетаскивания (Drag Logic)
local dragging, dragInput, dragStart, startPos
local function update(input)
    local delta = input.Position - dragStart
    menu.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
end

menu.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStart = input.Position
        startPos = menu.Position
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
end)

menu.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
        dragInput = input
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if input == dragInput and dragging then
        update(input)
    end
end)

-- Элементы внутри меню
local title = Instance.new("TextLabel", menu)
title.Size = UDim2.new(1, 0, 0, 40)
title.BackgroundTransparency = 1
title.Text = "HITBOX MENU"
title.Font = Enum.Font.GothamBold
title.TextColor3 = Color3.new(1, 1, 1)
title.TextSize = 16

local statusBtn = Instance.new("TextButton", menu)
statusBtn.Size = UDim2.new(0.85, 0, 0, 40)
statusBtn.Position = UDim2.new(0.075, 0, 0, 50)
statusBtn.Font = Enum.Font.GothamBold
statusBtn.TextSize = 14
statusBtn.TextColor3 = Color3.new(1, 1, 1)
local statusCorner = Instance.new("UICorner", statusBtn)

local sizeText = Instance.new("TextLabel", menu)
sizeText.Size = UDim2.new(1, 0, 0, 20)
sizeText.Position = UDim2.new(0, 0, 0, 100)
sizeText.BackgroundTransparency = 1
sizeText.TextColor3 = Color3.new(1, 1, 1)
sizeText.Font = Enum.Font.Gotham
sizeText.TextSize = 14

local sliderBg = Instance.new("Frame", menu)
sliderBg.Size = UDim2.new(0.85, 0, 0, 10)
sliderBg.Position = UDim2.new(0.075, 0, 0, 135)
sliderBg.BackgroundColor3 = Color3.fromRGB(60, 60, 70)
local sliderCorner = Instance.new("UICorner", sliderBg)

local sliderFill = Instance.new("Frame", sliderBg)
sliderFill.Size = UDim2.new(0.5, 0, 1, 0)
sliderFill.BackgroundColor3 = Color3.fromRGB(0, 255, 150)
local fillCorner = Instance.new("UICorner", sliderFill)

-- ========= UI FUNCTIONS =========
local function updateUI()
    if Settings.Enabled then
        statusBtn.Text = "STATUS: ON"
        statusBtn.BackgroundColor3 = Color3.fromRGB(0, 180, 100)
    else
        statusBtn.Text = "STATUS: OFF"
        statusBtn.BackgroundColor3 = Color3.fromRGB(180, 50, 50)
    end
    sizeText.Text = "Hitbox Size: " .. Settings.HitboxSize
    sliderFill.Size = UDim2.new(Settings.HitboxSize / Settings.MaxHitboxSize, 0, 1, 0)
    updateSphere()
end

-- Слайдер
local isSliding = false
local function updateSlider(input)
    local relativeX = math.clamp((input.Position.X - sliderBg.AbsolutePosition.X) / sliderBg.AbsoluteSize.X, 0, 1)
    Settings.HitboxSize = math.floor(relativeX * Settings.MaxHitboxSize)
    if Settings.HitboxSize < 3 then Settings.HitboxSize = 3 end
    updateUI()
end

sliderBg.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        isSliding = true
        updateSlider(input)
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if isSliding and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
        updateSlider(input)
    end
end)

UserInputService.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        isSliding = false
    end
end)

statusBtn.MouseButton1Click:Connect(function()
    Settings.Enabled = not Settings.Enabled
    updateUI()
end)

toggleBtn.MouseButton1Click:Connect(function()
    menu.Visible = not menu.Visible
end)

updateUI()
print("✅ Centered & Draggable Hitbox Loaded!")
